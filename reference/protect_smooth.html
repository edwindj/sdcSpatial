<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Protect a sdc_raster by smoothing — protect_smooth • sdcSpatial</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Protect a sdc_raster by smoothing — protect_smooth"><meta name="description" content="protect_smooth reduces the sensitivity by applying a Gaussian smoother,
making the values less localized."><meta property="og:description" content="protect_smooth reduces the sensitivity by applying a Gaussian smoother,
making the values less localized."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sdcSpatial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/sdcSpatial.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/edwindj/sdcSpatial/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Protect a sdc_raster by smoothing</h1>
      <small class="dont-index">Source: <a href="https://github.com/edwindj/sdcSpatial/blob/master/R/protect_smooth.R" class="external-link"><code>R/protect_smooth.R</code></a></small>
      <div class="d-none name"><code>protect_smooth.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>protect_smooth</code> reduces the sensitivity by applying a Gaussian smoother,
making the values less localized.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">protect_smooth</span><span class="op">(</span><span class="va">x</span>, bw <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">value</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>raster object</p></dd>


<dt id="arg-bw">bw<a class="anchor" aria-label="anchor" href="#arg-bw"></a></dt>
<dd><p>bandwidth</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>passed through to <code><a href="https://rspatial.github.io/terra/reference/focal.html" class="external-link">focal</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The sensitivity of a raster can be decreased by applying a kernel density smoother as
argued by de Jonge et al. (2016) and de Wolf et al. (2018). Smoothing spatially spreads
localized values, reducing the risk for location disclosure. Note that
smoothing often visually enhances detection of spatial patterns.
The kernel applied is a Gaussian kernel with a bandwidth <code>bw</code> supplied by the user.
The smoother acts upon the <code>x$value$count</code> and <code>x$value$sum</code>
from which a new <code>x$value$mean</code> is derived.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>de Jonge, E., &amp; de Wolf, P. P. (2016, September).
Spatial smoothing and statistical disclosure control.
In International Conference on Privacy in Statistical Databases
(pp. 107-117). Springer, Cham.</p>
<p>de Wolf, P. P., &amp; de Jonge, E. (2018, September).
Safely Plotting Continuous Variables on a Map. In International Conference
on Privacy in Statistical Databases (pp. 347-359). Springer, Cham.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other protection methods:
<code><a href="protect_quadtree.html">protect_quadtree</a>()</code>,
<code><a href="remove_sensitive.html">remove_sensitive</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edwindj/sdcSpatial" class="external-link">sdcSpatial</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">enterprises</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create a sdc_raster from point data with raster with</span></span></span>
<span class="r-in"><span><span class="co"># a resolution of 200m</span></span></span>
<span class="r-in"><span><span class="va">production</span> <span class="op">&lt;-</span> <span class="fu"><a href="sdc_raster.html">sdc_raster</a></span><span class="op">(</span><span class="va">enterprises</span>, variable <span class="op">=</span> <span class="st">"production"</span></span></span>
<span class="r-in"><span>                        , r <span class="op">=</span> <span class="fl">200</span>, min_count <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">production</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> numeric sdc_raster object: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    resolution: 200 200 ,  max_risk: 0.95 , min_count: 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    mean sensitivity score [0,1]:  0.6328234</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot the raster</span></span></span>
<span class="r-in"><span><span class="va">zlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3e4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># show which raster cells are sensitive</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">production</span>, zlim<span class="op">=</span><span class="va">zlim</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="protect_smooth-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># but we can also retrieve directly the raster</span></span></span>
<span class="r-in"><span><span class="va">sensitive</span> <span class="op">&lt;-</span> <span class="fu"><a href="is_sensitive.html">is_sensitive</a></span><span class="op">(</span><span class="va">production</span>, min_count <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sensitive</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'white'</span>, <span class="st">'red'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="protect_smooth-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># what is the sensitivy fraction?</span></span></span>
<span class="r-in"><span><span class="fu"><a href="sensitivity_score.html">sensitivity_score</a></span><span class="op">(</span><span class="va">production</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.6328234</span>
<span class="r-in"><span><span class="co"># or equally</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/cellStats.html" class="external-link">cellStats</a></span><span class="op">(</span><span class="va">sensitive</span>, <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.6328234</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># let's smooth to reduce the sensitivity</span></span></span>
<span class="r-in"><span><span class="va">smoothed</span> <span class="op">&lt;-</span> <span class="fu">protect_smooth</span><span class="op">(</span><span class="va">production</span>, bw <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">smoothed</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="protect_smooth-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># let's smooth to reduce the sensitivity, with higher resolution</span></span></span>
<span class="r-in"><span><span class="va">smoothed</span> <span class="op">&lt;-</span> <span class="fu">protect_smooth</span><span class="op">(</span><span class="va">production</span>, bw <span class="op">=</span> <span class="fl">400</span>, smooth_fact<span class="op">=</span><span class="fl">4</span>, keep_resolution<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">smoothed</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="protect_smooth-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># what is the sensitivy fraction?</span></span></span>
<span class="r-in"><span><span class="fu"><a href="sensitivity_score.html">sensitivity_score</a></span><span class="op">(</span><span class="va">smoothed</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.007902973</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># let's remove the sensitive data.</span></span></span>
<span class="r-in"><span><span class="va">smoothed_safe</span> <span class="op">&lt;-</span> <span class="fu"><a href="remove_sensitive.html">remove_sensitive</a></span><span class="op">(</span><span class="va">smoothed</span>, min_count <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">smoothed_safe</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="protect_smooth-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># let's communicate!</span></span></span>
<span class="r-in"><span><span class="va">production_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">smoothed_safe</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">production_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">smoothed_safe</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># and create a contour plot</span></span></span>
<span class="r-in"><span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/filledContour.html" class="external-link">filledContour</a></span><span class="op">(</span><span class="va">production_mean</span>, nlevels <span class="op">=</span> <span class="fl">6</span>, main <span class="op">=</span> <span class="st">"Mean production"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="protect_smooth-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># generated with R 3.6 &gt;=</span></span></span>
<span class="r-in"><span><span class="co">#col &lt;- hcl.colors(11, rev=TRUE)</span></span></span>
<span class="r-in"><span><span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FDE333"</span>, <span class="st">"#C2DE34"</span>, <span class="st">"#7ED357"</span>, <span class="st">"#00C475"</span>, <span class="st">"#00B28A"</span>, <span class="st">"#009B95"</span></span></span>
<span class="r-in"><span>        ,  <span class="st">"#008298"</span>, <span class="st">"#006791"</span>, <span class="st">"#274983"</span>, <span class="st">"#44286E"</span>, <span class="st">"#4B0055"</span></span></span>
<span class="r-in"><span>        <span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/filledContour.html" class="external-link">filledContour</a></span><span class="op">(</span><span class="va">production_total</span>, nlevels <span class="op">=</span> <span class="fl">11</span></span></span>
<span class="r-in"><span>             , col <span class="op">=</span> <span class="va">col</span></span></span>
<span class="r-in"><span>             , main<span class="op">=</span><span class="st">"Total production"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="protect_smooth-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edwin de Jonge, Peter-Paul de Wolf.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

