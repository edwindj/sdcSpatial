---
title: "sdcSpatial: Privacy protected density maps"
author: "Edwin de Jonge @edwindjonge"
date: "useR! 2019"
output: 
  beamer_presentation:
    include: 
      in_header: ./00tex/presheader.tex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## sdcSpatial: Privacy protected maps

```{r, echo=FALSE}
knitr::include_graphics("fig/privacy.jpg")
```

## sdcSpatial: Privacy protected maps

### Goal:

> Create maps, and ensure that no details are revealed on individuals.

## sdcSpatial: Privacy protected maps

### `sdcSpatial` has methods for:

- Creating a raster map: `sdc_raster` for pop density, value density and mean
density.
- Which locations are sensitive: `plot_sensitive`, `is_sensitive`
- Adjust raster map to protect data: `protect_smooth`, `protect_quadtree`
- Remove sensitive locations.

## Who am I?

- Statistical consultant, Data Scientist @cbs.nl / Statistics NL
- Expertise:

  - **R programming**
  - Data Cleaning with R
  - **Data visualization**
  - Complex networks analysis
  - @edwindjonge / <https://github.com/edwindj>

## What is SN / CBS?

Statistics Netherlands is producer of all main official statistics in the 
Netherlands:

- Stats on Demographics, economy (GDP), education, environment, agriculture, 
Finance etc.
- Part of the European Statistical System, ESS.

### Privacy motivation

- ESS has European Code of Statistical Practice (predates GDPR, European law 
on Data Protection): no individual information on persons and enterprises 
may be revealed.

## Sdc in `sdcSpatial`?

SDC = "Statistical Disclosure Control"

### Collection of statistical methods to:

- Check if density map is safe to be published
- Protect data by slightly altering (aggregated) data
  - adding noise
  - shifting mass
- Most SDC methods operate on records.
- **`sdcSpatial` works upon location data.**

## Lets create a raster map with `sdc_raster`

```{r}
library(sdcSpatial)
unemployed <- sdc_raster( dwellings[c("x", "y")] 
                        , dwellings$unemployed
                        , r = 500
                        , min_count = 10 # min support
                        )
print(unemployed)
```
### What is the sensitivity?

Binary score (`logical`) per raster cell indicating 
if it's unsafe to publish.

### Calculated:

a) Per location $(x_i,y_i)$ (raster cell)
b) Using risk function `disclosure_risk` $r(x,y) \in [0,1]$. 
How accurate can an attacker estimate the value of an individual?  
If $r(x_i,y_i) >$ `max_risk` then $(x_i,y_i)$ is sensitive.
c) Using a minimum number of observations.  
If $\textsf{count}_i$ `< min_count`, then $(x_i,y_i)$ is sensitive.

## Type of raster density maps:

Density can be area-based:

- number of people per square (`unemployed$value$count`): population density
- (total) value per square (`unemployed$value$sum`): number of unemployed per square.

Or density can population based:
- Mean value per square (`unemployed$value$mean`): probability of being unemployed per square.

_All types can be valid, but note that (total) value per square 
strongly interacts with population density. (see <https://xkcd.com/1138>)_


## So let's plot!

```{r, out.height="90%"}
plot(unemployed)
```


## how to improve?

- Use a coarser raster: `sdc_raster`.
- Spatial smoothing: `protect_smooth`[^jonge].
- Quadtree aggregation: `protect_quadtree`.
- Removing sensitive locations: `remove_sensitive`.


## Option: coarsening

```{r, out.height="90%"}
unemployed_1km <- sdc_raster(dwellings[c("x", "y")], dwellings$unemployed, r =1e3)
plot(unemployed_1km)
```


## Option Smoothing

```{r, out.height="90%", warning=FALSE}
unemployed_smoothed <- protect_smooth(unemployed, bw = 1500)
plot(unemployed_smoothed)
```

## Quadtree

```{r, warning=FALSE}
unemployed_100m <- sdc_raster(dwellings[c("x","y")], dwellings$unemployed, r = 200)
unemployed_qt <- protect_quadtree(unemployed_100m)
plot(unemployed_qt)
```


## Implementation `sdc_raster`

- built upon excellent `raster` 
- Creates internally an `raster::brick` object
- Stores the stats needed for calculating disclosure.

##

## The end

### Thank you for your antention!

### Questions?

### Curious?

```{r, eval=FALSE}
install.packages("sdcSpatial")
```

### Feedback and suggestions?

<https://github.com/edwindj/sdcSpatial/issues>
